"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){var i="BackgroundVideo";"function"==typeof define&&define.amd?define([],t(i)):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t(i):e[i]=t(i)}(window||module||{},(function(e){var t={parallax:{effect:1.5},pauseVideoOnViewLoss:!1,preventContextMenu:!1,minimumVideoWidth:400,autoplayFallback:"",onBeforeReady:function(){},onReady:function(){}},i=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t};return function(){function e(i,n){_classCallCheck(this,e),this.element=document.querySelectorAll(i),this.options=_extends({},t,n),this.options.browserPrexix=this.detectBrowser(),this.shimRequestAnimationFrame(),this.options.has3d=this.detect3d(),this.setWindowDimensions();for(var o=0;o<this.element.length;o++)this.init(this.element[o],o)}return _createClass(e,[{key:"init",value:function(e,t){this.el=e,this.playEvent=this.videoReadyCallback.bind(this),this.setVideoWrap(t),this.setVideoProperties(),this.insertVideos(),this.options&&this.options.onBeforeReady()&&this.options.onBeforeReady(),this.el.readyState>3?this.videoReadyCallback():(this.el.addEventListener("canplaythrough",this.playEvent,!1),this.el.addEventListener("canplay",this.playEvent,!1)),this.options.preventContextMenu&&this.el.addEventListener("contextmenu",(function(){return!1}))}},{key:"videoReadyCallback",value:function(){this.el.removeEventListener("canplaythrough",this.playEvent,!1),this.el.removeEventListener("canplay",this.playEvent,!1),this.options.originalVideoW=this.el.videoWidth,this.options.originalVideoH=this.el.videoHeight,this.bindEvents(),this.requestTick(),this.options&&this.options.onReady()&&this.options.onReady()}},{key:"bindEvents",value:function(){this.ticking=!1,this.options.parallax&&window.addEventListener("scroll",this.requestTick.bind(this)),window.addEventListener("resize",this.requestTick.bind(this)),window.addEventListener("resize",this.setWindowDimensions.bind(this))}},{key:"setWindowDimensions",value:function(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight}},{key:"requestTick",value:function(){this.ticking||(this.ticking=!0,window.requestAnimationFrame(this.positionObject.bind(this)))}},{key:"positionObject",value:function(){var e=window.pageYOffset,t=this.scaleObject(),i=t.xPos,n=t.yPos;n=this.options.parallax?e>=0?this.calculateYPos(n,e):this.calculateYPos(n,0):-n;var o=this.options.has3d?"translate3d("+i+"px, "+n+"px, 0)":"translate("+i+"px, "+n+"px)";this.el.style[""+this.options.browserPrexix]=o,this.el.style.transform=o,this.ticking=!1}},{key:"scaleObject",value:function(){var e=this.windowWidth/this.options.originalVideoW,t=this.windowHeight/this.options.originalVideoH,i=void 0;this.options.bvVideoWrap.style.width=this.windowWidth+"px",this.options.bvVideoWrap.style.height=this.windowHeight+"px",(i=e>t?e:t)*this.options.originalVideoW<this.options.minimumVideoWidth&&(i=this.options.minimumVideoWidth/this.options.originalVideoW);var n=i*this.options.originalVideoW,o=i*this.options.originalVideoH;return this.el.style.width=n+"px",this.el.style.height=o+"px",{xPos:-parseInt((n-this.windowWidth)/2),yPos:parseInt(o-this.windowHeight)/2}}},{key:"calculateYPos",value:function(e,t){return e=-((parseInt(this.options.bvVideoWrap.offsetTop)-t)/this.options.parallax.effect+e)}},{key:"setVideoWrap",value:function(e){var t=document.createElement("div");this.options.bvVideoWrapClass=this.el.className+"-wrap-"+e,i(t,"bv-video-wrap"),i(t,this.options.bvVideoWrapClass),t.style.position="relative",t.style.overflow="hidden",t.style.zIndex="10",this.el.parentNode.insertBefore(t,this.el),t.appendChild(this.el),this.options.bvVideoWrap=document.querySelector("."+this.options.bvVideoWrapClass)}},{key:"setVideoProperties",value:function(){this.el.setAttribute("preload","metadata"),this.el.setAttribute("loop","true"),this.el.setAttribute("autoplay","true"),this.el.style.position="absolute",this.el.style.zIndex="1";var e=this.options.autoplayFallback;e&&this.el.setAttribute("poster",e)}},{key:"insertVideos",value:function(){for(var e=0;e<this.options.src.length;e++){var t=this.options.src[e].split("."),i=t[t.length-1];this.addSourceToVideo(this.options.src[e],"video/"+i)}}},{key:"addSourceToVideo",value:function(e,t){var i=document.createElement("source");i.src=e,i.type=t,this.el.appendChild(i)}},{key:"detectBrowser",value:function(){var e=navigator.userAgent.toLowerCase(),t=void 0;return e.indexOf("chrome")>-1||e.indexOf("safari")>-1?t="webkitTransform":e.indexOf("firefox")>-1?t="MozTransform":-1!==e.indexOf("MSIE")||e.indexOf("Trident/")>0?t="msTransform":e.indexOf("Opera")>-1&&(t="OTransform"),t}},{key:"shimRequestAnimationFrame",value:function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var n=(new Date).getTime(),o=Math.max(0,16-(n-e)),s=window.setTimeout((function(){t(n+o)}),o);return e=n+o,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}},{key:"detect3d",value:function(){var e,t,i=document.createElement("p"),n={WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MSTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(e in document.body.insertBefore(i,document.body.lastChild),n)void 0!==i.style[e]&&(i.style[e]="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",t=window.getComputedStyle(i).getPropertyValue(n[e]));return i.parentNode.removeChild(i),void 0!==t&&"none"!==t}}]),e}()}));